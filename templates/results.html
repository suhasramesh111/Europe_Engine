<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ditto Results</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
  <body>
    <div class="container">
      <form method="post" action="/">
        <input type="text" name="query" list = "past-queries" placeholder="Enter your search query..." value="{{ query }}" required>
          <datalist id="past-queries">
              {% for q in history %}
                <option value="{{ q }}">
              {% endfor %}
          </datalist>

        <select name="method" required>
          <option value="relevance">Relevance</option>
          <option value="pagerank">PageRank</option>
          <option value="hits">HITS</option>
          <option value="flat">Flat Cluster</option>
          <!-- <option value="kmeans">K-means Basic Search</option> -->
          <option value="agglo_single">Agglomerative (Single) Cluster</option>
          <option value="agglo_complete">Agglomerative (Complete) Cluster</option>
          <option value="rocchio">Rocchio</option>
          <option value="association">Association</option>
          <option value="metric">Metric</option>
          <option value="scalar">Scalar</option>
        </select>

        <button type="submit">Search</button>      
      </form>

      <!-- Tab Buttons -->
      <!-- <div class="tab-buttons">
        <button class="tab-btn active" onclick="showTab(event, 'relevance')">Relevance</button>
        <button class="tab-btn" onclick="showTab(event, 'page_rank')">Page Rank</button>
        <button class="tab-btn" onclick="showTab(event, 'hits')">HITS</button>
        <button class="tab-btn" onclick="showTab(event, 'flat_clustering')">Flat Clustering</button>
        <button class="tab-btn" onclick="showTab(event, 'aglo_clustering')">Agglomerative Single</button>
        <button class="tab-btn" onclick="showTab(event, 'aglo_com_clustering')">Agglomerative Complete</button>
        <button class="tab-btn" onclick="showTab(event, 'rocchio')">Rocchio</button>
        <button class="tab-btn" onclick="showTab(event, 'association')">Associations</button>
        <button class="tab-btn" onclick="showTab(event, 'metric')">Metric</button>
        <button class="tab-btn" onclick="showTab(event, 'scalar')">Scalar</button>
      </div> -->

      <p style="margin: 10px 0; font-weight: bold; display: flex; gap: 5px; align-items: center; flex-wrap: wrap;">
        Expanded Query: <span id="expandedQueryText" style="font-style: italic;"></span>
      </p>
           
      <div class="columns">
       <!-- Custom Column -->
        <div class="column">
          <div class="results-box">
            <h2>Custom Results</h2>

            <!-- Tab Contents -->
            <div id="results_tab" class="tab-content" style="display: none;">
              <ul>
                {% for r in results.relevance %}
                  <li><a href="{{ r.url }}" target="_blank">{{ r.title }}</a></li>
                {% endfor %}
              </ul>
              <ul>
                {% for r in results %}
                  <li><a href="{{ r.url }}" target="_blank">{{ r.title }}</a></li>
                {% endfor %}
              </ul>
            </div>

          </div>
        </div>


        <!-- Google + Bing Column -->
        <div class="column">
          <div class="results-box">
            <h2>Google Results</h2>
            <ul>
              {% for r in results_google %}
                <li><a href="{{ r.link }}" target="_blank">{{ r.title }}</a><p>{{ r.snippet }}</p></li>
              {% endfor %}
            </ul>
          </div>
        </div>


          <div class="results-box">
            <h2>Bing Results</h2>
            <iframe id="bingFrame" src="https://www.bing.com/search?q={{ query }}" width="100%" height="100%" style="border:none;"></iframe>
          </div>
        </div>
      </div>
    
    </div>

    <script>
        function showTab(evt, tabId) 
          {
            const contents = document.querySelectorAll(".tab-content");
            const buttons  = document.querySelectorAll(".tab-btn");

            // Hide all tab contents and remove active class
            contents.forEach(content => content.style.display = "none");
            buttons.forEach(btn => btn.classList.remove("active"));

            // Show selected tab content
            document.getElementById(tabId).style.display = "block";

            // If triggered by a button click
            if (evt && evt.currentTarget) 
              {
                evt.currentTarget.classList.add("active");
              } 
            else 
              {
                // Select the button by matching its onclick handler
                const tabBtn = document.querySelector(`.tab-btn[onclick*="${tabId}"]`);
                if (tabBtn) tabBtn.classList.add("active");
              } 
            
            const expandedContainer = document.getElementById("expandedQueryText");
            const algo = "{{ algo }}";  // assign once

            if (algo === 'rocchio' || algo === 'association' || algo === 'metric' || algo === 'scalar') 
              {
                  expandedContainer.textContent = "{{ expanded_query }}";
                  expandedContainer.style.display = 'block';
              }
            else 
              {
                  expandedContainer.textContent = "";
                  expandedContainer.style.display = 'none';
              }


            if (algo === 'rocchio') 
              {
                document.querySelector('select[name="method"]').value = 'rocchio';
              } 
            else if (algo === 'association') 
              {
                document.querySelector('select[name="method"]').value = 'association';
              } 
            else if (algo === 'scalar') 
              {
                document.querySelector('select[name="method"]').value = 'scalar';
              } 
            else if (algo === 'metric') 
              {
                document.querySelector('select[name="method"]').value = 'metric';
              } 
            // else if (algo === 'kmeans') 
            //   {
            //     document.querySelector('select[name="method"]').value = 'kmeans';
            //   } 
            else if (algo === 'hits') 
              {
                document.querySelector('select[name="method"]').value = 'hits';
              } 
            else if (algo === 'pagerank')
               {
                document.querySelector('select[name="method"]').value = 'pagerank';
              } 
            else if (algo === 'relevance') 
              {
                document.querySelector('select[name="method"]').value = 'relevance';
              }
            else if (algo === 'flat') 
              {
                document.querySelector('select[name="method"]').value = 'flat';
              } 
            else if (algo === 'agglo_single') 
              {
                document.querySelector('select[name="method"]').value = 'agglo_single';
              } 
            else if (algo === 'agglo_complete') 
              {
                document.querySelector('select[name="method"]').value = 'agglo_complete';
              } 


          }


          window.onload = () => {
                                  showTab(null, 'results_tab');
                                };
    </script>

  </body>
</html>
